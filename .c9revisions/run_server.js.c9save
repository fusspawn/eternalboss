{"ts":1347804914630,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var app = require('http').createServer(static_handler)\n  , socket = require('socket.io').listen(app)\n  , fs = require('fs')\n  , url = require('url')\n  , path = require('path')\n  , WorldMan = require('./server/managers/world-manager.js')\n  , PlayMan = require(\"./server/managers/player-manager.js\")\n\napp.listen(process.env.PORT, process.env.HOST);\n\nserver = {};\nserver.world_manager = new WorldMan();\nserver.player_manager = new PlayMan();\n\nserver.world_manager.init();\nserver.player_manager.init();\n\nserver.socket_man = socket;\nserver.socket_man.configure(function () {\n       server.socket_man.set('transports', ['websocket']);\n});\nserver.socket_man.sockets.on('connection', function (socket) {\n    console.log(\"Incoming Connections\");\n    server.player_manager.incoming_player(socket);\n});\n\n\nfunction static_handler(request, response) {\n\n  var uri = url.parse(request.url).pathname\n    , filename = path.join(process.cwd(), uri);\n  \n  path.exists(filename, function(exists) {\n    if(!exists) {\n      response.writeHead(404, {\"Content-Type\": \"text/plain\"});\n      response.write(\"404 Not Found\\n\");\n      response.end();\n      return;\n    }\n\n    if (fs.statSync(filename).isDirectory()) filename += '/index.html';\n\n    fs.readFile(filename, \"binary\", function(err, file) {\n      if(err) {        \n        response.writeHead(500, {\"Content-Type\": \"text/plain\"});\n        response.write(err + \"\\n\");\n        response.end();\n        return;\n      }\n\n      response.writeHead(200);\n      response.write(file, \"binary\");\n      response.end();\n    });\n  });\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":1555}]],"length":1555}
