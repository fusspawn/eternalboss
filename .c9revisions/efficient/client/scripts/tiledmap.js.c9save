{"ts":1350238012966,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"function TiledMap(url) {\n    client_data.scene.make_scene_object.call(client_data.scene, this);\n    this.isDrawable = true;\n    this.isUpdateable = true;\n    \n    this.map = null;\n    this.loaded = false;\n    this.loading = 0;\n    this.sprite_sheet_images = {};\n    this.sprite_sheet_mappings = {};\n    \n    this.sprite_cache = {};\n    \n    client_data.resources.get_map(url, function(map_json) {\n        this.map = map_json;\n        console.log(this.map);\n        this.process_sprite_sheets();    \n    }, this);\n    \n    this.process_sprite_sheets = function() {\n        for(var index in this.map.tilesets) {\n            var tile_set = this.map.tilesets[index];\n            this.loading++;\n            client_data.renderer.create_canvas_buffer(tile_set.image, function(image) {\n                this.sprite_sheet_images[this.get_safe_key(tile_set.image)] = image;\n                this.loading--;\n                \n                if(this.loading == 0)\n                    this.loaded = true;\n            }, this);\n        }       \n    };\n\n    this.update = function(delta) {\n        if(!this.loaded)\n            return;\n    \n    };\n    \n    this.draw = function(delta) {\n        if(!this.loaded)\n            return;\n    \n        for(var index in this.map.layers)\n            this.draw_layer(this.map.layers[index], this);\n    };\n    \n    this.get_safe_key = function(path) {\n        var copy = path;\n        copy.replace(\"/\", \"_\");\n        copy.replace(\"\\\\\", \"_\");\n        copy.replace(\".\", \"_\");\n        copy.replace(\":\", \"_\");\n        return copy;\n    };\n    \n    this.draw_layer = function(layer, context) {\n        var idx = 0;\n        for(var x = 0; x < layer.width; x++) {\n            for(var y = 0; y < layer.width; y++) {\n                var tile_id = layer.data[idx];  \n                if(tile_id > 0) {\n                    var tdata = context.get_tile_image_and_rect(tile_id);\n                    var sheet_context = context.sprite_sheet_images[context.get_safe_key(tdata.tile_sheet.image)];\n                    client_data.renderer.draw_buffer_section(sheet_context, tdata.bb.x, tdata.bb.y, tdata.bb.w, tdata.bb.h,\n                        x * tdata.bb.w, y * tdata.bb.h, tdata.bb.w, tdata.bb.h);\n                }\n                idx++;\n            }\n        }\n    }; \n    \n    this.get_tile_image_and_rect = function(id) {\n            if(this.sprite_cache[id] != null)\n                return this.sprite_cache[id];\n        \n            var tile_sheet = null;\n            for(var index in this.map.tilesets) {\n                var ts = this.map.tilesets[index];\n                if(tile_sheet == null)\n                    tile_sheet = ts;\n                \n                if(ts.firstgid <= id \n                    && ts.firstgid > tile_sheet.firstgid)\n                    tile_sheet = ts;\n            }\n            \n            var bb = {};\n            var index = ts.firstgid; \n            for(var x = 0; x < ts.width; x++) {\n                for(var y = 0; y < ts.height; y++) {\n                    index++\n                    if(index == id) {\n                        bb.x = x;    \n                        bb.y = y;\n                        bb.w = ts.tilewidth;\n                        bb.h = ts.tileheight;\n                    }\n                }\n            }\n            \n            this.sprite_cache[id] = {tile_sheet: ts, bb: bb};\n    };\n}"]],"start1":0,"start2":0,"length1":0,"length2":3354}]],"length":3354}
{"contributors":[],"silentsave":false,"ts":1350238032319,"patch":[[{"diffs":[[0,"    "],[-1,"    var tile_set = this.map.tilesets[index];\n            this.loading++;\n            client_data.renderer.create_canvas_buffer(tile_set.image, function(image) {\n                this.sprite_sheet_images[this.get_safe_key(tile_set.image)] = image;\n                this.loading--;\n                \n                if(this.loading == 0)\n                    this.loaded = true;\n            }, this);"],[0,"\n"],[1,""],[0,"    "]],"start1":614,"start2":614,"length1":403,"length2":9},{"diffs":[[0,"    "],[-1," var idx = 0;\n        for(var x = 0; x < layer.width; x++) {\n            for(var y = 0; y < layer.width; y++) {\n                var tile_id = layer.data[idx];  \n                if(tile_id > 0) {\n                    var tdata = context.get_tile_image_and_rect(tile_id);\n                    var sheet_context = context.sprite_sheet_images[context.get_safe_key(tdata.tile_sheet.image)];\n                    client_data.renderer.draw_buffer_section(sheet_context, tdata.bb.x, tdata.bb.y, tdata.bb.w, tdata.bb.h,\n                        x * tdata.bb.w, y * tdata.bb.h, tdata.bb.w, tdata.bb.h);\n                }\n                idx++;\n            }\n        }\n    }; \n    \n    this.get_tile_image_and_rect = function(id) {\n            if(this.sprite_cache[id] != null)\n                return this.sprite_cache[id];\n        \n            var tile_sheet = null;\n            for(var index in this.map.tilesets) {\n                var ts = this.map.tilesets[index];\n                if(tile_sheet == null)\n                    tile_sheet = ts;\n                \n                if(ts.firstgid <= id \n                    && ts.firstgid > tile_sheet.firstgid)\n                    tile_sheet = ts;\n            }\n            \n            var bb = {};\n            var index = ts.firstgid; \n            for(var x = 0; x < ts.width; x++) {\n                for(var y = 0; y < ts.height; y++) {\n                    index++\n                    if(index == id) {\n                        bb.x = x;    \n                        bb.y = y;\n                        bb.w = ts.tilewidth;\n                        bb.h = ts.tileheight;\n                    }\n                }\n            }\n            \n            this.sprite_cache[id] = {tile_sheet: ts, bb: bb};"],[0,"\n    };"],[1," "],[0,"\n}"]],"start1":1219,"start2":1219,"length1":1741,"length2":14}]],"length":1233,"saved":false}
{"ts":1350238090904,"patch":[[{"diffs":[[0,") {\n        "],[1,"    var ts = this.map.tilesets[index];"],[0,"\n        }  "]],"start1":606,"start2":606,"length1":24,"length2":62}]],"length":1271,"saved":false}
{"ts":1350238146845,"patch":[[{"diffs":[[0,"index];\n"],[1,"            \n"],[0,"        "]],"start1":649,"start2":649,"length1":16,"length2":29}]],"length":1284,"saved":false}
{"ts":1350238222092,"patch":[[{"diffs":[[0,"            "],[1,"var image_path = this.get_safe_key(ts.image);"],[0,"\n        }  "]],"start1":657,"start2":657,"length1":24,"length2":69}]],"length":1329,"saved":false}
{"ts":1350238381111,"patch":[[{"diffs":[[0,"image);\n"],[1,"            client_data.renderer.create_cavnas_buffer(ts.image, function(image) {\n                this.sprite_sheet_images[image_path] = image;\n            }, this);\n"],[0,"        "]],"start1":707,"start2":707,"length1":16,"length2":182}]],"length":1495,"saved":false}
{"ts":1350238492228,"patch":[[{"diffs":[[0,"image);\n"],[1,"            \n"],[0,"        "]],"start1":707,"start2":707,"length1":16,"length2":29}]],"length":1508,"saved":false}
{"ts":1350238524883,"patch":[[{"diffs":[[0,"  }, this);\n"],[1,"            \n            \n"],[0,"        }   "]],"start1":882,"start2":882,"length1":24,"length2":50}]],"length":1534,"saved":false}
{"ts":1350238527435,"patch":[[{"diffs":[[0,"pings = {};\n"],[-1,"    \n"],[0,"    this.spr"]],"start1":287,"start2":287,"length1":29,"length2":24}]],"length":1529,"saved":false}
{"ts":1350238543891,"patch":[[{"diffs":[[0,"   \n            "],[1,"var first_index = ts.firstgid;        "],[0,"\n        }      "]],"start1":898,"start2":898,"length1":32,"length2":70}]],"length":1567,"saved":false}
{"ts":1350238636020,"patch":[[{"diffs":[[0,"irstgid;"],[1,"\n"],[0,"        "],[1,"    var index = 0;\n            for(var x = 0; x < ts.width; x++) {\n                for(var y = 0; y < ts.height; y++) {  \n                    this.sprite_sheet_mappings[first_index]\n                }\n            }"],[0,"\n       "]],"start1":936,"start2":936,"length1":24,"length2":238}]],"length":1781,"saved":false}
{"ts":1350238643275,"patch":[[{"diffs":[[0,"st_index"],[-1,"]"],[1," + index]\n                    index++;"],[0,"\n       "]],"start1":1125,"start2":1125,"length1":17,"length2":54}]],"length":1818,"saved":false}
{"ts":1350238717844,"patch":[[{"diffs":[[0,"+ index]"],[1," = {\n                        x: x * ts.tilewidth,\n                        y: y * ts.tileheight,\n                        w: ts.tilewidth,\n                        h: ts.tileheight\n                    };"],[0,"\n       "]],"start1":1134,"start2":1134,"length1":16,"length2":216}]],"length":2018,"saved":false}
{"ts":1350238743244,"patch":[[{"diffs":[[0,"h; x++) "],[1,"\n            "],[0,"{\n      "]],"start1":1010,"start2":1010,"length1":16,"length2":29},{"diffs":[[0,"ht; y++)"],[1,"\n               "],[0," {  \n   "]],"start1":1075,"start2":1075,"length1":16,"length2":32}]],"length":2047,"saved":false}
{"ts":1350238749112,"patch":[[{"diffs":[[0,"         };\n"],[1,"                    \n"],[0,"            "]],"start1":1360,"start2":1360,"length1":24,"length2":45}]],"length":2068,"saved":false}
{"ts":1350238796536,"patch":[[{"diffs":[[0,"lesets) "],[1,"\n        "],[0,"{\n      "]],"start1":595,"start2":595,"length1":16,"length2":25},{"diffs":[[0," index = 0;\n"],[1,"            \n"],[0,"            "]],"start1":969,"start2":969,"length1":24,"length2":37}]],"length":2090,"saved":false}
{"ts":1350238825151,"patch":[[{"diffs":[[0,"nction()"],[1,"\n   "],[0," {\n     "]],"start1":548,"start2":548,"length1":16,"length2":20}]],"length":2094,"saved":false}
{"ts":1350238842627,"patch":[[{"diffs":[[0,"ayer"],[-1,", context) {\n"],[1,") {\n     "],[0,"    "]],"start1":2060,"start2":2060,"length1":21,"length2":17}]],"length":2090,"saved":false}
{"ts":1350238879581,"patch":[[{"diffs":[[0,"on(layer) {\n"],[1,"        for(var x = 0; x < layer.width; x++)\n            for(var y = 0; y < layer.height; y++)\n    "],[0,"            "]],"start1":2056,"start2":2056,"length1":24,"length2":123}]],"length":2189,"saved":false}
{"ts":1350238888917,"patch":[[{"diffs":[[0,"leheight"],[1,",\n                        ts: ts"],[0,"\n       "]],"start1":1366,"start2":1366,"length1":16,"length2":48}]],"length":2221,"saved":false}
{"ts":1350238908789,"patch":[[{"diffs":[[0,"th; x++)"],[1," {"],[0,"\n       "]],"start1":2136,"start2":2136,"length1":16,"length2":18},{"diffs":[[0,"yer.height; y++)"],[1," { "],[0,"\n     "],[1,"       }\n        }"],[0,"           \n    "]],"start1":2180,"start2":2180,"length1":38,"length2":59}]],"length":2244,"saved":false}
{"ts":1350239064899,"patch":[[{"diffs":[[0,"on(layer) {\n"],[1,"        var idx = 0\n"],[0,"        for("]],"start1":2088,"start2":2088,"length1":24,"length2":44},{"diffs":[[0,"y++) { \n"],[1,"                var bbts = layer.data[\n                client_data.renderer.draw_buffer_section(this.context, mappings.x, mappings.y, mappings.w, mappings.h, this.x, this.y, this.width, this.height);\n"],[0,"        "]],"start1":2212,"start2":2212,"length1":16,"length2":216}]],"length":2464,"saved":false}
{"ts":1350239065789,"patch":[[{"diffs":[[0," idx = 0"],[1,";"],[0,"\n       "]],"start1":2111,"start2":2111,"length1":16,"length2":17}]],"length":2465,"saved":false}
{"ts":1350239086093,"patch":[[{"diffs":[[0,"var "],[-1,"bbts"],[1,"tid"],[0," = l"]],"start1":2237,"start2":2237,"length1":12,"length2":11},{"diffs":[[0,"er.data["],[1,"idx];"],[0,"\n       "]],"start1":2250,"start2":2250,"length1":16,"length2":21}]],"length":2469,"saved":false}
{"ts":1350239113870,"patch":[[{"diffs":[[0,"    "],[-1,"client_data.renderer.draw_buffer_section(this.context, mappings.x, mappings.y, mappings.w, mappings.h, this.x, this.y, this.width, this.height);"],[1,"if(tid != 0) {\n                    \n                }"],[0,"\n   "]],"start1":2276,"start2":2276,"length1":152,"length2":61}]],"length":2378,"saved":false}
{"ts":1350239137829,"patch":[[{"diffs":[[0,"                "],[1,"var tile = this.sprite_sheet_mappings[tid];"],[0,"\n               "]],"start1":2299,"start2":2299,"length1":32,"length2":75}]],"length":2421,"saved":false}
{"ts":1350239180237,"patch":[[{"diffs":[[0,"  ts: ts"],[1,",\n                        key: image_path"],[0,"\n       "]],"start1":1398,"start2":1398,"length1":16,"length2":57},{"diffs":[[0,"s[tid];\n"],[1,"                    client_data.renderer.draw_buffer_section(tile.\n"],[0,"        "]],"start1":2392,"start2":2392,"length1":16,"length2":83}]],"length":2529,"saved":false}
{"ts":1350239267649,"patch":[[{"diffs":[[0,"on(t"],[-1,"ile."],[1,"his.sprite_sheet_images[tile.key],\n                        tile.x, tile.y, tile.w, tile.h, x * tile.ts.tilewidth, y * tile.ts.tileheight,\n                        tile.ts.tilewidth, tile.ts.tileheight);"],[0,"\n   "]],"start1":2458,"start2":2458,"length1":12,"length2":209}]],"length":2726,"saved":false}
{"ts":1350239315255,"patch":[[{"diffs":[[0,"e_ca"],[-1,"v"],[0,"n"],[1,"v"],[0,"as_b"]],"start1":774,"start2":774,"length1":10,"length2":10}]],"length":2726,"saved":false}
{"ts":1350239387863,"patch":[[{"diffs":[[0,"    "],[-1,"if(!this.loaded)\n            return;\n    "],[0,"\n   "]],"start1":1618,"start2":1618,"length1":49,"length2":8},{"diffs":[[0,") {\n"],[-1,"        if(!this.loaded)\n            return;\n    \n"],[0,"    "]],"start1":1665,"start2":1665,"length1":58,"length2":8}]],"length":2635,"saved":false}
{"ts":1350239475846,"patch":[[{"diffs":[[0,"nction(delta) {\n"],[1,"        if(this.map == null)\n            return;\n        \n"],[0,"        for(var "]],"start1":1653,"start2":1653,"length1":32,"length2":90}]],"length":2693,"saved":false}
{"ts":1350239486341,"patch":[[{"diffs":[[0,") {\n        "],[1,"if(this.map == null)\n            return;"],[0,"\n    };\n    "]],"start1":1610,"start2":1610,"length1":24,"length2":64}]],"length":2733,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350239723847,"patch":[[{"diffs":[[0,"              }\n"],[1,"                \n                tid++;\n"],[0,"            }\n  "]],"start1":2673,"start2":2673,"length1":32,"length2":72}]],"length":2773,"saved":false}
{"ts":1350239732849,"patch":[[{"diffs":[[0,"        "],[-1,"t"],[0,"id"],[1,"x"],[0,"++;\n    "]],"start1":2714,"start2":2714,"length1":19,"length2":19}]],"length":2773,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350384550851,"patch":[[{"diffs":[[0,"    "],[-1,"this.sprite_cache = {};"],[1,""],[0,"\n   "]],"start1":299,"start2":299,"length1":31,"length2":8},{"diffs":[[0,"    "],[-1,"\n            client_data.renderer.create_canvas_buffer(ts.image, function(image) {\n                this.sprite_sheet_images[image_path] = image;\n            }, this);\n            \n            var first_index = ts.firstgid;\n            var index = 0;\n            \n            for(var x = 0; x < ts.width; x++) \n            {\n                for(var y = 0; y < ts.height; y++)\n                {  \n                    this.sprite_sheet_mappings[first_index + index] = {\n                        x: x * ts.tilewidth,\n                        y: y * ts.tileheight,\n                        w: ts.tilewidth,\n                        h: ts.tileheight,\n                        ts: ts,\n                        key: image_path\n                    };\n                    \n                    index++;\n                }\n            }\n        }       \n    };"],[1,"var sheet_mappings = this.create_mappings(ts);\n        }       \n    };\n    \n    this.create_mappings(ts) {\n        \n    }"],[0,"\n\n  "]],"start1":708,"start2":708,"length1":849,"length2":129},{"diffs":[[0,") {\n"],[-1,"        if(this.map == null)\n            return;\n        \n"],[0,"    "]],"start1":962,"start2":962,"length1":66,"length2":8},{"diffs":[[0,"var "],[-1,"x"],[1,"y"],[0," = 0; "],[-1,"x"],[1,"y"],[0," < l"]],"start1":1380,"start2":1380,"length1":16,"length2":16},{"diffs":[[0,"yer."],[-1,"width; x"],[1,"height; y"],[0,"++) "]],"start1":1397,"start2":1397,"length1":16,"length2":17},{"diffs":[[0,"    for(var "],[-1,"y"],[1,"x"],[0," = 0; "],[-1,"y"],[1,"x"],[0," < layer.hei"]],"start1":1424,"start2":1424,"length1":32,"length2":32},{"diffs":[[0,"; x < layer."],[-1,"height; y"],[1,"width; x"],[0,"++) { \n     "]],"start1":1441,"start2":1441,"length1":33,"length2":32},{"diffs":[[0,"x];\n"],[-1,"                if(tid != 0) {\n                    var tile = this.sprite_sheet_mappings[tid];\n                    client_data.renderer.draw_buffer_section(this.sprite_sheet_images[tile.key],\n                        tile.x, tile.y, tile.w, tile.h, x * tile.ts.tilewidth, y * tile.ts.tileheight,\n                        tile.ts.tilewidth, tile.ts.tileheight);\n                }\n                \n"],[0,"    "]],"start1":1507,"start2":1507,"length1":402,"length2":8}]],"length":1578,"saved":false}
{"ts":1350384601270,"patch":[[{"diffs":[[0,"pings(ts) {\n"],[1,"        var sprite_width = ts.imagewidth;\n        var sprite_height = ts.imageheight;\n"],[0,"        \n   "]],"start1":807,"start2":807,"length1":24,"length2":110}]],"length":1664,"saved":false}
{"ts":1350384643538,"patch":[[{"diffs":[[0,"ate_mappings"],[1," = function"],[0,"(ts) {\n     "]],"start1":800,"start2":800,"length1":24,"length2":35}]],"length":1675,"saved":false}
{"ts":1350384656666,"patch":[[{"diffs":[[0,"t;\n        \n"],[1,"        \n"],[0,"    }\n\n    t"]],"start1":913,"start2":913,"length1":24,"length2":33}]],"length":1684,"saved":false}
{"ts":1350384693415,"patch":[[{"diffs":[[0,"ht;\n        "],[1,"var rect_width = sprite_width / ts.tilewidth;\n        var rect_height = sprite_height / ts.tileheight;"],[0,"\n        \n  "]],"start1":912,"start2":912,"length1":24,"length2":126}]],"length":1786,"saved":false}
{"ts":1350384735355,"patch":[[{"diffs":[[0,"t;\n        \n"],[1,"        for(var x = 0; x < ts.imagewidth; x++) {\n            for(var y = 0; y < ts.imageheight; y++) {\n                \n            }\n        }\n        \n"],[0,"    }\n\n    t"]],"start1":1024,"start2":1024,"length1":24,"length2":177}]],"length":1939,"saved":false}
{"ts":1350384745871,"patch":[[{"diffs":[[0," ts.tileheight;\n"],[1,"        var mapping_ids = {};\n"],[0,"        \n       "]],"start1":1011,"start2":1011,"length1":32,"length2":62}]],"length":1969,"saved":false}
{"ts":1350384753544,"patch":[[{"diffs":[[0,"ping"],[-1,"_ids"],[0," = {"]],"start1":1042,"start2":1042,"length1":12,"length2":8}]],"length":1965,"saved":false}
{"ts":1350384786449,"patch":[[{"diffs":[[0,"pping = {};\n"],[1,"        var gid = ts.firstgid;\n        var index = 0;\n"],[0,"        \n   "]],"start1":1041,"start2":1041,"length1":24,"length2":78},{"diffs":[[0,"                "],[1,"mapping"],[0,"\n            }\n "]],"start1":1219,"start2":1219,"length1":32,"length2":39}]],"length":2026,"saved":false}
{"ts":1350384854542,"patch":[[{"diffs":[[0,"width; x"],[-1,"++"],[1," += sprite_width"],[0,") {\n    "]],"start1":1151,"start2":1151,"length1":18,"length2":32},{"diffs":[[0,"s.imageheight; y"],[-1,"++"],[1," += sprite_height"],[0,") {\n            "]],"start1":1211,"start2":1211,"length1":34,"length2":49},{"diffs":[[0," mapping"],[1,"[gid + index] = {\n                    x: x,\n                    y: y,\n                    w: sprite_width,\n                    h: sprite_height\n                }"],[0,"\n       "]],"start1":1263,"start2":1263,"length1":16,"length2":177}]],"length":2216,"saved":false}
{"ts":1350384890285,"patch":[[{"diffs":[[0,"              }\n"],[1,"                \n                console.log(\"registered mapping: \", gid + index, mapping[gid + index].toString());\n"],[0,"            }\n  "]],"start1":1417,"start2":1417,"length1":32,"length2":148}]],"length":2332,"saved":false}
{"ts":1350384896122,"patch":[[{"diffs":[[0,"ing: \", "],[1,"("],[0,"gid + in"]],"start1":1494,"start2":1494,"length1":16,"length2":17},{"diffs":[[0," + index"],[1,")"],[0,", mappin"]],"start1":1506,"start2":1506,"length1":16,"length2":17}]],"length":2334,"saved":false}
{"ts":1350384916067,"patch":[[{"diffs":[[0,"ing());\n"],[1,"                index++l\n"],[0,"        "]],"start1":1543,"start2":1543,"length1":16,"length2":41}]],"length":2359,"saved":false}
{"ts":1350384916956,"patch":[[{"diffs":[[0," index++"],[-1,"l"],[1,";"],[0,"\n       "]],"start1":1566,"start2":1566,"length1":17,"length2":17}]],"length":2359,"saved":false}
{"ts":1350384925745,"patch":[[{"diffs":[[0,"      }\n"],[-1,"        \n"],[0,"    }\n\n "]],"start1":1592,"start2":1592,"length1":25,"length2":16}]],"length":2350,"saved":false}
{"ts":1350384955173,"patch":[[{"diffs":[[0,"ppings(ts);\n"],[1,"            var sprite = new SpriteSheet(ts.image, sheet_mappings);\n"],[0,"        }   "]],"start1":747,"start2":747,"length1":24,"length2":92}]],"length":2418,"saved":false}
{"ts":1350385074892,"patch":[[{"diffs":[[0,"nction(delta) {\n"],[1,"        if(this.map == null)\n            return;\n        \n"],[0,"        for(var "]],"start1":1790,"start2":1790,"length1":32,"length2":90}]],"length":2476,"saved":false}
{"ts":1350385148160,"patch":[[{"diffs":[[0,"ht;\n"],[-1,"        var rect_width = sprite_width / ts.tilewidth;\n        var rect_height = sprite_height / ts.tileheight;\n"],[0,"    "]],"start1":980,"start2":980,"length1":119,"length2":8}]],"length":2365,"saved":false}
{"ts":1350385176671,"patch":[[{"diffs":[[0,"}\n        }\n"],[1,"        \n        return mapping;\n"],[0,"    }\n\n    t"]],"start1":1545,"start2":1545,"length1":24,"length2":57}]],"length":2398,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350385280904,"patch":[[{"diffs":[[0,"_width = ts."],[-1,"imag"],[1,"til"],[0,"ewidth;\n    "]],"start1":916,"start2":916,"length1":28,"length2":27},{"diffs":[[0,"height = ts."],[-1,"imag"],[1,"til"],[0,"eheight;\n   "]],"start1":958,"start2":958,"length1":28,"length2":27}]],"length":2396,"saved":false}
{"ts":1350385355522,"patch":[[{"diffs":[[0,"   \n    };\n    \n"],[1,"    this.get_correct_sheet = function(id) {\n    \n    };\n    \n"],[0,"    this.create_"]],"start1":840,"start2":840,"length1":32,"length2":93}]],"length":2457,"saved":false}
{"ts":1350385369108,"patch":[[{"diffs":[[0,"pings = {};\n"],[1,"    this.sprite_sheets = Array();\n"],[0,"    \n    \n  "]],"start1":287,"start2":287,"length1":24,"length2":58}]],"length":2491,"saved":false}
{"ts":1350385398725,"patch":[[{"diffs":[[0,"_mappings);\n"],[1,"            this.sprite_sheets.push(sprite);\n"],[0,"        }   "]],"start1":849,"start2":849,"length1":24,"length2":69}]],"length":2536,"saved":false}
{"ts":1350385416693,"patch":[[{"diffs":[[0,"_mappings);\n"],[1,"            \n"],[0,"            "]],"start1":849,"start2":849,"length1":24,"length2":37}]],"length":2549,"saved":false}
{"ts":1350385450200,"patch":[[{"diffs":[[0,"n(id) {\n    "],[1,"    for(var i = 0; i < this.sprite_sheets.length; i++) {\n            \n        }"],[0,"\n    };\n    "]],"start1":984,"start2":984,"length1":24,"length2":103}]],"length":2628,"saved":false}
{"ts":1350385480854,"patch":[[{"diffs":[[0,") {\n            "],[1,"var ss - this.sprite_sheets[i];"],[0,"\n        }\n    }"]],"start1":1049,"start2":1049,"length1":32,"length2":63}]],"length":2659,"saved":false}
{"ts":1350385488509,"patch":[[{"diffs":[[0,"ets[i];\n"],[1,"            \n"],[0,"        "]],"start1":1089,"start2":1089,"length1":16,"length2":29}]],"length":2672,"saved":false}
{"ts":1350413254123,"patch":[[{"diffs":[[0,"ction(id) {\n"],[1,"        var last_ss = null;\n"],[0,"        for("]],"start1":980,"start2":980,"length1":24,"length2":52},{"diffs":[[0," ss "],[-1,"-"],[1,"="],[0," thi"]],"start1":1096,"start2":1096,"length1":9,"length2":9},{"diffs":[[0,"i];\n            "],[1,"if(last_ss == null)\n                last_ss = ss;\n                \n            if(ss.firstgid < id && ss.firstgid > last_ss.firstgid)\n                last_ss = ss;"],[0,"\n        }\n    }"]],"start1":1121,"start2":1121,"length1":32,"length2":195}]],"length":2863,"saved":false}
{"ts":1350413268669,"patch":[[{"diffs":[[0,";\n        }\n"],[1,"        \n        \n        return last_ss;\n"],[0,"    };\n    \n"]],"start1":1299,"start2":1299,"length1":24,"length2":66}]],"length":2905,"saved":false}
{"ts":1350413296772,"patch":[[{"diffs":[[0,".data[idx];\n"],[1,"                var ss = this.get_correct_sheet(tid);\n"],[0,"            "]],"start1":2826,"start2":2826,"length1":24,"length2":78}]],"length":2959,"saved":false}
{"ts":1350413322265,"patch":[[{"diffs":[[0,"t(tid);\n"],[1,"                ss.current_frame = tid\n"],[0,"        "]],"start1":2884,"start2":2884,"length1":16,"length2":55}]],"length":2998,"saved":false}
{"ts":1350413322913,"patch":[[{"diffs":[[0,"me = tid"],[1,";"],[0,"\n       "]],"start1":2922,"start2":2922,"length1":16,"length2":17}]],"length":2999,"saved":false}
{"ts":1350413371435,"patch":[[{"diffs":[[0,"index], "],[-1,"this"],[1,"delta"],[0,");\n    }"]],"start1":2379,"start2":2379,"length1":20,"length2":21},{"diffs":[[0,"rame = tid;\n"],[1,"                ss.x = x * ss.tilewidth;\n                ss.y = y * ss.tileheight;\n                ss.update.call(ss, \n"],[0,"            "]],"start1":2921,"start2":2921,"length1":24,"length2":143}]],"length":3119,"saved":false}
{"ts":1350413377217,"patch":[[{"diffs":[[0,"all(ss, "],[1,"delta); "],[0,"\n       "]],"start1":3043,"start2":3043,"length1":16,"length2":24}]],"length":3127,"saved":false}
{"ts":1350413384800,"patch":[[{"diffs":[[0," delta);"],[-1," "],[1,"\n                ss.draw.call(ss, delta);"],[0,"\n       "]],"start1":3050,"start2":3050,"length1":17,"length2":57}]],"length":3167,"saved":false}
{"ts":1350413403901,"patch":[[{"diffs":[[0,"on(layer"],[1,", delta"],[0,") {\n    "]],"start1":2663,"start2":2663,"length1":16,"length2":23}]],"length":3174,"saved":false}
{"ts":1350413470928,"patch":[[{"diffs":[[0,"                "],[1,"\n                if(tid != 0) {\n                    "],[0,"var ss = this.ge"]],"start1":2846,"start2":2846,"length1":32,"length2":84},{"diffs":[[0,"        "],[1,"    "],[0,"ss.curre"]],"start1":2960,"start2":2960,"length1":16,"length2":20},{"diffs":[[0,"        "],[1," "],[1,"   "],[0,"ss.x = x"]],"start1":3004,"start2":3004,"length1":16,"length2":20},{"diffs":[[0,"* ss.tilewidth;\n"],[1,"    "],[0,"                "]],"start1":3025,"start2":3025,"length1":32,"length2":36},{"diffs":[[0," ss.tileheight;\n"],[1,"    "],[0,"                "]],"start1":3071,"start2":3071,"length1":32,"length2":36},{"diffs":[[0,"        "],[1,"    "],[0,"ss.draw."]],"start1":3142,"start2":3142,"length1":16,"length2":20},{"diffs":[[0,"all(ss, delta);\n"],[1,"                }\n"],[0,"                "]],"start1":3163,"start2":3163,"length1":32,"length2":50}]],"length":3264,"saved":false}
{"ts":1350413475441,"patch":[[{"diffs":[[0,"a[idx];\n"],[-1,"                \n"],[0,"        "]],"start1":2838,"start2":2838,"length1":33,"length2":16}]],"length":3247,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350413910865,"patch":[[{"diffs":[[0," 0;\n"],[-1,"    this.sprite_sheet_images = {};\n    this.sprite_sheet_mappings = {};\n"],[0,"    "]],"start1":223,"start2":223,"length1":80,"length2":8}]],"length":3175,"saved":false}
{"ts":1350413958503,"patch":[[{"diffs":[[0,"_mappings);\n"],[1,"            sprite.tilewidth = ts.tilewidth;\n            sprite.tileheight = ts.tileheight;\n"],[0,"            "]],"start1":777,"start2":777,"length1":24,"length2":116}]],"length":3267,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350415581471,"patch":[[{"diffs":[[0," ts.tileheight;\n"],[1,"        \n        var x_count = Math.floor(ts.imagewidth / sprite_width);\n        var y_count = Math.floor(ts.imageheight / sprite_height);\n        \n        console.log(\"X count: \", x_count, \" Y Count: \", y_count);\n        \n"],[0,"        var mapp"]],"start1":1495,"start2":1495,"length1":32,"length2":255},{"diffs":[[0,"g = {};\n"],[-1,""],[0,"        "]],"start1":1752,"start2":1752,"length1":16,"length2":16},{"diffs":[[0,"     x: "],[-1,"x"],[1,"y"],[0,",\n      "]],"start1":2011,"start2":2011,"length1":17,"length2":17},{"diffs":[[0,"     y: "],[-1,"y"],[1,"x"],[0,",\n      "]],"start1":2037,"start2":2037,"length1":17,"length2":17},{"diffs":[[0,"              }\n"],[1,""],[0,"                "]],"start1":2124,"start2":2124,"length1":32,"length2":32},{"diffs":[[0,"   \n"],[-1,"                console.log(\"registered mapping: \", (gid + index), mapping[gid + index].toString());\n"],[0,"    "]],"start1":2153,"start2":2153,"length1":109,"length2":8}]],"length":3389,"saved":false}
{"ts":1350415597347,"patch":[[{"diffs":[[0," 0; x < "],[-1,"ts.imagewidth"],[1,"x_count"],[0,"; x += s"]],"start1":1842,"start2":1842,"length1":29,"length2":23},{"diffs":[[0," 0; y < "],[-1,"ts.imageheigh"],[1,"y_coun"],[0,"t; y += "]],"start1":1903,"start2":1903,"length1":29,"length2":22}]],"length":3376,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350416042830,"patch":[[{"diffs":[[0,"t; x += "],[-1,"sprite_width"],[1,"1"],[0,") {\n    "]],"start1":1856,"start2":1856,"length1":28,"length2":17},{"diffs":[[0,"t; y += "],[-1,"sprite_height"],[1,"1"],[0,") {\n    "]],"start1":1906,"start2":1906,"length1":29,"length2":17},{"diffs":[[0,"    x: y"],[1," * sprite_height"],[0,",\n      "]],"start1":1976,"start2":1976,"length1":16,"length2":32},{"diffs":[[0,"    y: x"],[1," * sprite_width"],[0,",\n      "]],"start1":2018,"start2":2018,"length1":16,"length2":31}]],"length":3384,"saved":false}
{"ts":1350416208178,"patch":[[{"diffs":[[0,"     x: "],[-1,"y"],[1,"x"],[0," * sprit"]],"start1":1975,"start2":1975,"length1":17,"length2":17},{"diffs":[[0," sprite_"],[-1,"height"],[1,"width"],[0,",\n      "]],"start1":1986,"start2":1986,"length1":22,"length2":21},{"diffs":[[0,"     y: "],[-1,"x"],[1,"y"],[0," * sprit"]],"start1":2016,"start2":2016,"length1":17,"length2":17},{"diffs":[[0,"  y: y * sprite_"],[-1,"width"],[1,"height"],[0,",\n              "]],"start1":2019,"start2":2019,"length1":37,"length2":38}]],"length":3384,"saved":false}
{"ts":1350416485391,"patch":[[{"diffs":[[0,"all(ss, delta);\n"],[1,"                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight);\n"],[0,"                "]],"start1":3283,"start2":3283,"length1":32,"length2":155}]],"length":3507,"saved":false}
{"ts":1350416732453,"patch":[[{"diffs":[[0,"s.tileheight"],[1,", \"rgba(255,0,0,0.5)\""],[0,");\n         "]],"start1":3407,"start2":3407,"length1":24,"length2":45}]],"length":3528,"saved":false}
{"ts":1350416948315,"patch":[[{"diffs":[[0,"ht, "],[-1,"\"rgba(255,0,0,0.5)\""],[1,"ss.debug_color"],[0,");\n "]],"start1":3417,"start2":3417,"length1":27,"length2":22}]],"length":3523,"saved":false}
{"ts":1350417064407,"patch":[[{"diffs":[[0," ts.tileheight;\n"],[1,"            sprite.debug_color = \"rgba(\"+Math.Floor(Math.Random() * 255)+ \",\" + \n                                        Math.Floor(Math.Random() * 255)+ \",\" +\n                                        Math.Floor(Math.Random() * 255)+ \",255)\";\n"],[0,"            \n   "]],"start1":865,"start2":865,"length1":32,"length2":274}]],"length":3765,"saved":false}
{"ts":1350417096635,"patch":[[{"diffs":[[0,"Math.Floor(Math."],[-1,"R"],[1,"r"],[0,"andom() * 255)+ "]],"start1":922,"start2":922,"length1":33,"length2":33},{"diffs":[[0,"Math.Floor(Math."],[-1,"R"],[1,"r"],[0,"andom() * 255)+ "]],"start1":1002,"start2":1002,"length1":33,"length2":33},{"diffs":[[0,"ath."],[-1,"R"],[1,"r"],[0,"ando"]],"start1":1093,"start2":1093,"length1":9,"length2":9}]],"length":3765,"saved":false}
{"ts":1350417146158,"patch":[[{"diffs":[[0,"rgba(\"+Math."],[-1,"F"],[1,"f"],[0,"loor(Math.ra"]],"start1":915,"start2":915,"length1":25,"length2":25},{"diffs":[[0,"           Math."],[-1,"F"],[1,"f"],[0,"loor(Math.random"]],"start1":991,"start2":991,"length1":33,"length2":33},{"diffs":[[0,"ath."],[-1,"F"],[1,"f"],[0,"loor"]],"start1":1082,"start2":1082,"length1":9,"length2":9}]],"length":3765,"saved":false}
{"ts":1350417232511,"patch":[[{"diffs":[[0,"       for(var i"],[-1,"ndex in"],[1," = 0; i <"],[0," this.map.layers"]],"start1":2673,"start2":2673,"length1":39,"length2":41},{"diffs":[[0,"p.layers"],[1,".length; i++"],[0,")\n      "]],"start1":2706,"start2":2706,"length1":16,"length2":28},{"diffs":[[0,"layers[i"],[-1,"ndex"],[0,"], delta"]],"start1":2765,"start2":2765,"length1":20,"length2":16}]],"length":3775,"saved":false}
{"ts":1350417460917,"patch":[[{"diffs":[[0,"color);\n"],[1,"                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, tid.toString(), ss.debug_color);\n"],[0,"        "]],"start1":3682,"start2":3682,"length1":16,"length2":143}]],"length":3902,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350418919650,"patch":[[{"diffs":[[0,"for(var "],[-1,"y"],[1,"x"],[0," = 0; "],[-1,"y"],[1,"x"],[0," < layer"]],"start1":3100,"start2":3100,"length1":24,"length2":24},{"diffs":[[0,"yer."],[-1,"height; y"],[1,"width; x"],[0,"++) {"],[1," "],[0,"\n   "]],"start1":3121,"start2":3121,"length1":22,"length2":22},{"diffs":[[0,"    for(var "],[-1,"x"],[1,"y"],[0," = 0; "],[-1,"x"],[1,"y"],[0," < layer.wid"]],"start1":3148,"start2":3148,"length1":32,"length2":32},{"diffs":[[0,"; y < layer."],[-1,"width; x"],[1,"height; y"],[0,"++) {"],[-1," "],[0,"\n           "]],"start1":3165,"start2":3165,"length1":38,"length2":38}]],"length":3902,"saved":false}
{"ts":1350421690481,"patch":[[{"diffs":[[0,"    "],[-1,"\n        for(var x = 0; x < x_count; x += 1) {\n"],[1,"var _len = x_count * y_count;\n    "],[0,"    "],[1,"\n"],[0,"    "]],"start1":2060,"start2":2060,"length1":59,"length2":47},{"diffs":[[0,"var "],[-1,"y"],[1,"i"],[0," = 0; "],[-1,"y < y_count; y += 1"],[1,"i < _len; i++"],[0,") {\n"]],"start1":2115,"start2":2115,"length1":34,"length2":28},{"diffs":[[0,"    "],[-1,"    mapping[gid + index] = {\n                    x: x * sprite_width,\n                    y: y * sprite_height,\n                    w: sprite_width,\n    "],[1,"var x = i % x_count;\n            var y = i / x_count | 0;\n            mappings[gid + i] = {\n"],[0,"    "]],"start1":2151,"start2":2151,"length1":161,"length2":100},{"diffs":[[0,"    "],[-1,"h: sprite_height\n                }\n                \n                index++;"],[1,"x: x,\n                y: y"],[0,"\n   "]],"start1":2259,"start2":2259,"length1":84,"length2":34}]],"length":3773,"saved":false}
{"ts":1350421825691,"patch":[[{"diffs":[[0," mapping"],[-1,"s"],[0,"[gid + i"]],"start1":2224,"start2":2224,"length1":17,"length2":16}]],"length":3772,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350424044964,"patch":[[{"diffs":[[0,")\";\n            "],[-1,""],[0,""],[1,"sprite.firstgid = ts.firstgid;\n            "],[0,"\n            thi"]],"start1":1119,"start2":1119,"length1":32,"length2":75},{"diffs":[[0,"rs[i], delta"],[-1,""],[0,""],[1,", i"],[0,");\n    };\n  "]],"start1":2682,"start2":2682,"length1":24,"length2":27},{"diffs":[[0,"layer, delta"],[1,", id"],[0,") {\n        "]],"start1":2971,"start2":2971,"length1":24,"length2":28},{"diffs":[[0,"    for(var "],[1,"index = 0; index < layer.data.length; index++)\n        {\n            var tid = layer.data[index];\n            if(tid != 0)\n            {\n                var x = index % layer.width;\n                var y = index / layer.width | 0; \n                var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.width = ss.tilewidth;\n                    ss.height = ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n            }\n        }\n        \n        /*for(var "],[0,"x = 0; x < l"]],"start1":3016,"start2":3016,"length1":24,"length2":939},{"diffs":[[0,"ht, "],[-1,"tid.toString()"],[1,"x+\":\"+y"],[0,", ss"]],"start1":4615,"start2":4615,"length1":22,"length2":15},{"diffs":[[0,"     }  "],[-1,"  "],[1,"*/"],[0,"       \n"]],"start1":4703,"start2":4703,"length1":18,"length2":18}]],"length":4730,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350426530776,"patch":[[{"diffs":[[1,"function TiledMap(url) {\n    client_data.scene.make_scene_object.call(client_data.scene, this);\n    this.isDrawable = true;\n    this.isUpdateable = true;\n    \n    this.map = null;\n    this.loaded = false;\n    this.loading = 0;\n    this.sprite_sheets = Array();\n    \n    \n    client_data.resources.get_map(url, function(map_json) {\n        this.map = map_json;\n        console.log(this.map);\n        this.process_sprite_sheets();    \n    }, this);\n    \n    this.process_sprite_sheets = function()\n    {\n        for(var index in this.map.tilesets) \n        {\n            var ts = this.map.tilesets[index];\n            var image_path = this.get_safe_key(ts.image);\n            var sheet_mappings = this.create_mappings(ts);\n            var sprite = new SpriteSheet(ts.image, sheet_mappings);\n            sprite.tilewidth = ts.tilewidth;\n            sprite.tileheight = ts.tileheight;\n            sprite.debug_color = \"rgba(\"+Math.floor(Math.random() * 255)+ \",\" + \n                                        Math.floor(Math.random() * 255)+ \",\" +\n                                        Math.floor(Math.random() * 255)+ \",255)\";\n            sprite.firstgid = ts.firstgid;\n            \n            this.sprite_sheets.push(sprite);\n        }       \n    };\n    \n    this.get_correct_sheet = function(id) {\n        var last_ss = null;\n        for(var i = 0; i < this.sprite_sheets.length; i++) {\n            var ss = this.sprite_sheets[i];\n            if(last_ss == null)\n                last_ss = ss;\n                \n            if(ss.firstgid < id && ss.firstgid > last_ss.firstgid)\n                last_ss = ss;\n        }\n        \n        \n        return last_ss;\n    };\n    \n    this.create_mappings = function(ts) {\n        var sprite_width = ts.tilewidth;\n        var sprite_height = ts.tileheight;\n        \n        var x_count = Math.floor(ts.imagewidth / sprite_width);\n        var y_count = Math.floor(ts.imageheight / sprite_height);\n        \n        console.log(\"X count: \", x_count, \" Y Count: \", y_count);\n        \n        var mapping = {};\n        var gid = ts.firstgid;\n        var _len = x_count * y_count;\n        \n        for(var i = 0; i < _len; i++) {\n            var x = i % x_count;\n            var y = i / x_count | 0;\n            mapping[gid + i] = {\n                x: x,\n                y: y\n            }\n        }\n        \n        return mapping;\n    }\n\n    this.update = function(delta) {\n        if(this.map == null)\n            return;\n    };\n    \n    this.draw = function(delta) {\n        if(this.map == null)\n            return;\n        \n        for(var i = 0; i < this.map.layers.length; i++)\n            this.draw_layer(this.map.layers[i], delta, i);\n    };\n    \n    this.get_safe_key = function(path) {\n        var copy = path;\n        copy.replace(\"/\", \"_\");\n        copy.replace(\"\\\\\", \"_\");\n        copy.replace(\".\", \"_\");\n        copy.replace(\":\", \"_\");\n        return copy;\n    };\n    \n    this.draw_layer = function(layer, delta, id) {\n        var idx = 0;\n        for(var index = 0; index < layer.data.length; index++)\n        {\n            var tid = layer.data[index];\n            if(tid != 0)\n            {\n                var x = index % layer.width;\n                var y = index / layer.width | 0; \n                var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.width = ss.tilewidth;\n                    ss.height = ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n            }\n        }\n        \n        /*for(var x = 0; x < layer.width; x++) { \n            for(var y = 0; y < layer.height; y++) {\n                var tid = layer.data[idx];\n                if(tid != 0) {\n                    var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n                }\n                idx++;\n            }\n        }  */       \n    }; \n}"]],"start1":0,"start2":0,"length1":0,"length2":4707}]],"length":4707,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350426566997,"patch":[[{"diffs":[[0,"    "],[-1,"\n    \n    client_data.resources.get_map(url, function(map_json) {\n        this.map = map_json;\n        console.log(this.map);\n        this.process_sprite_sheets();    \n    }, this);\n    \n    this.process_sprite_sheets = function()\n    {\n        for(var index in this.map.tilesets) \n        {\n            var ts = this.map.tilesets[index];\n            var image_path = this.get_safe_key(ts.image);\n            var sheet_mappings = this.create_mappings(ts);\n            var sprite = new SpriteSheet(ts.image, sheet_mappings);\n            sprite.tilewidth = ts.tilewidth;\n            sprite.tileheight = ts.tileheight;\n            sprite.debug_color = \"rgba(\"+Math.floor(Math.random() * 255)+ \",\" + \n                                        Math.floor(Math.random() * 255)+ \",\" +\n                                        Math.floor(Math.random() * 255)+ \",255)\";\n            sprite.firstgid = ts.firstgid;\n            \n            this.sprite_sheets.push(sprite);\n        }       \n    };\n    \n    this.get_correct_sheet = function(id) {\n        var last_ss = null;\n        for(var i = 0; i < this.sprite_sheets.length; i++) {\n            var ss = this.sprite_sheets[i];\n            if(last_ss == null)\n                last_ss = ss;\n                \n            if(ss.firstgid < id && ss.firstgid > last_ss.firstgid)\n                last_ss = ss;\n        }\n        \n        \n        return last_ss;\n    };\n    \n    this.create_mappings = function(ts) {\n        var sprite_width = ts.tilewidth;\n        var sprite_height = ts.tileheight;\n        \n        var x_count = Math.floor(ts.imagewidth / sprite_width);\n        var y_count = Math.floor(ts.imageheight / sprite_height);\n        \n        console.log(\"X count: \", x_count, \" Y Count: \", y_count);\n        \n        var mapping = {};\n        var gid = ts.firstgid;\n        var _len = x_count * y_count;\n        \n        for(var i = 0; i < _len; i++) {\n            var x = i % x_count;\n            var y = i / x_count | 0;\n            mapping[gid + i] = {\n                x: x,\n                y: y\n            }\n        }\n        \n        return mapping;\n    }\n\n    this.update = function(delta) {\n        if(this.map == null)\n            return;\n    };\n    \n    this.draw = function(delta) {\n        if(this.map == null)\n            return;\n        \n        for(var i = 0; i < this.map.layers.length; i++)\n            this.draw_layer(this.map.layers[i], delta, i);\n    };\n    \n    this.get_safe_key = function(path) {\n        var copy = path;\n        copy.replace(\"/\", \"_\");\n        copy.replace(\"\\\\\", \"_\");\n        copy.replace(\".\", \"_\");\n        copy.replace(\":\", \"_\");\n        return copy;\n    };\n    \n    this.draw_layer = function(layer, delta, id) {\n        var idx = 0;\n        for(var index = 0; index < layer.data.length; index++)\n        {\n            var tid = layer.data[index];\n            if(tid != 0)\n            {\n                var x = index % layer.width;\n                var y = index / layer.width | 0; \n                var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.width = ss.tilewidth;\n                    ss.height = ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n            }\n        }\n        \n        /*for(var x = 0; x < layer.width; x++) { \n            for(var y = 0; y < layer.height; y++) {\n                var tid = layer.data[idx];\n                if(tid != 0) {\n                    var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n                }\n                idx++;\n            }\n        }  */       \n    }; \n}function TiledMap(url) {\n    client_data.scene.make_scene_object.call(client_data.scene, this);\n    this.isDrawable = true;\n    this.isUpdateable = true;\n    \n    this.map = null;\n    this.loaded = false;\n    this.loading = 0;\n    this.sprite_sheets = Array();\n    "],[1,"this.global_mappings {};"],[0,"\n   "]],"start1":261,"start2":261,"length1":4715,"length2":32},{"diffs":[[0,"pping = {};\n"],[1,""],[0,"        var "]],"start1":2057,"start2":2057,"length1":24,"length2":24},{"diffs":[[0,"id;\n"],[-1,"        var index = 0;\n"],[0,"    "]],"start1":2096,"start2":2096,"length1":31,"length2":8}]],"length":4731,"saved":false}
{"ts":1350426589310,"patch":[[{"diffs":[[0,"ction(id) {\n"],[1,"        return this.global_mappings[id].sheet;\n        \n        \n"],[0,"        var "]],"start1":1309,"start2":1309,"length1":24,"length2":89}]],"length":4796,"saved":false}
{"ts":1350426601466,"patch":[[{"diffs":[[0,"    y: y"],[1,",\n                sheet: ts,"],[0,"\n       "]],"start1":2389,"start2":2389,"length1":16,"length2":44}]],"length":4824,"saved":false}
{"ts":1350426640588,"patch":[[{"diffs":[[0,"    y: y"],[1,"\n            }\n            \n            this.global_mappings[gid + i] = {\n                x:x,\n                y:y"],[0,",\n      "]],"start1":2389,"start2":2389,"length1":16,"length2":130},{"diffs":[[0,"heet: ts"],[-1,","],[0,"\n       "]],"start1":2530,"start2":2530,"length1":17,"length2":16}]],"length":4937,"saved":false}
{"ts":1350426665854,"patch":[[{"diffs":[[0," y\n            }"],[1,";"],[0,"\n            \n  "]],"start1":2395,"start2":2395,"length1":32,"length2":33}]],"length":4938,"saved":false}
{"ts":1350426670667,"patch":[[{"diffs":[[0,"ts\n            }"],[1,";"],[0,"\n        }\n     "]],"start1":2537,"start2":2537,"length1":32,"length2":33}]],"length":4939,"saved":false}
{"ts":1350426674009,"patch":[[{"diffs":[[0,"    y: y"],[1,","],[0,"\n       "]],"start1":2389,"start2":2389,"length1":16,"length2":17}]],"length":4940,"saved":false}
{"ts":1350426677264,"patch":[[{"diffs":[[0,"heet: ts"],[1,","],[0,"\n       "]],"start1":2532,"start2":2532,"length1":16,"length2":17}]],"length":4941,"saved":false}
{"ts":1350426694957,"patch":[[{"diffs":[[0,"mappings"],[1," ="],[0," {};\n   "]],"start1":277,"start2":277,"length1":16,"length2":18}]],"length":4943,"saved":false}
{"ts":1350426782164,"patch":[[{"diffs":[[0," };\n"],[-1,"            \n            this.global_mappings[gid + i] = {\n                x:x,\n                y:y,\n                sheet: ts,\n            };\n"],[0,"    "]],"start1":2412,"start2":2412,"length1":151,"length2":8}]],"length":4800,"saved":false}
{"ts":1350426804932,"patch":[[{"diffs":[[0,"_mappings);\n"],[1,"            \n"],[0,"            "]],"start1":803,"start2":803,"length1":24,"length2":37},{"diffs":[[0," = ts.firstgid;\n"],[1,"            this.update_global_mappings(sprite);\n"],[0,"            \n   "]],"start1":1189,"start2":1189,"length1":32,"length2":81}]],"length":4862,"saved":false}
{"ts":1350426809157,"patch":[[{"diffs":[[0,"prite);\n"],[-1,"            \n"],[0,"        "]],"start1":1246,"start2":1246,"length1":29,"length2":16}]],"length":4849,"saved":false}
{"ts":1350426851476,"patch":[[{"diffs":[[0,"   \n    };\n    \n"],[1,"    this.update_global_mappings = function(sprite) {\n        for(var i in sprite.sprite_mappings)\n    };\n    \n"],[0,"    this.get_cor"]],"start1":1312,"start2":1312,"length1":32,"length2":142}]],"length":4959,"saved":false}
{"ts":1350426862070,"patch":[[{"diffs":[[0,"appings)"],[1," {\n            \n        }"],[0,"\n    };\n"]],"start1":1417,"start2":1417,"length1":16,"length2":41}]],"length":4984,"saved":false}
{"ts":1350426875541,"patch":[[{"diffs":[[0,"pings(sprite"],[1,", mappings"],[0,");\n         "]],"start1":1239,"start2":1239,"length1":24,"length2":34}]],"length":4994,"saved":false}
{"ts":1350426880854,"patch":[[{"diffs":[[0,"n(sprite"],[1,", mappings"],[0,") {\n    "]],"start1":1379,"start2":1379,"length1":16,"length2":26}]],"length":5004,"saved":false}
{"ts":1350426899075,"patch":[[{"diffs":[[0," in "],[-1,"sprite.sprite_"],[0,"mapp"]],"start1":1418,"start2":1418,"length1":22,"length2":8},{"diffs":[[0,") {\n            "],[1,"mappings[i].sheet = sprite;"],[0,"\n        }\n    }"]],"start1":1430,"start2":1430,"length1":32,"length2":59}]],"length":5017,"saved":false}
{"ts":1350426939256,"patch":[[{"diffs":[[0,"appings(sprite, "],[1,"sheet_"],[0,"mappings);\n     "]],"start1":1237,"start2":1237,"length1":32,"length2":38}]],"length":5023,"saved":false}
{"ts":1350427007926,"patch":[[{"diffs":[[0,"sprite;\n"],[1,"            this.global_mappings[i] = mappings[i];\n"],[0,"        "]],"start1":1472,"start2":1472,"length1":16,"length2":67}]],"length":5074,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350429902938,"patch":[[{"diffs":[[0,"var "],[-1,"image_path = this.get_safe_key(ts.image);\n            var "],[0,""],[1,""],[0,"shee"]],"start1":642,"start2":642,"length1":66,"length2":8},{"diffs":[[0,"    x: x"],[1," * sprite_width"],[0,",\n      "]],"start1":2585,"start2":2585,"length1":16,"length2":31},{"diffs":[[0,"    y: y"],[1," * sprite_height"],[0,",\n      "]],"start1":2622,"start2":2622,"length1":16,"length2":32},{"diffs":[[0,"yer("],[-1,"this.map.layers[i], "],[0,""],[1,""],[0,"delt"]],"start1":2982,"start2":2982,"length1":28,"length2":8},{"diffs":[[0,"ion("],[-1,"layer, "],[0,"delt"]],"start1":3264,"start2":3264,"length1":15,"length2":8},{"diffs":[[0,"var "],[-1,"idx = 0"],[1,"layer = this.map.layers[id]"],[0,";\n  "]],"start1":3289,"start2":3289,"length1":15,"length2":35},{"diffs":[[0,"x];\n"],[-1,"            if(tid != 0)\n            {\n    "],[0,"    "]],"start1":3432,"start2":3432,"length1":51,"length2":8},{"diffs":[[0,"ayer.width;\n"],[-1,"    "],[0,"            "]],"start1":3465,"start2":3465,"length1":28,"length2":24},{"diffs":[[0,"\n               "],[1,"\n            if(tid != 0)\n            {\n                "],[0," var ss = this.g"]],"start1":3522,"start2":3522,"length1":32,"length2":88},{"diffs":[[0,"     ss.x = x * "],[-1,"ss"],[1,"this.map"],[0,".tilewidth;\n    "]],"start1":3692,"start2":3692,"length1":34,"length2":40},{"diffs":[[0,"     ss.y = y * "],[-1,"ss"],[1,"this.map"],[0,".tileheight;\n   "]],"start1":3743,"start2":3743,"length1":34,"length2":40},{"diffs":[[0,"             ss."],[-1,"update"],[1,"draw"],[0,".call(ss, delta)"]],"start1":3879,"start2":3879,"length1":38,"length2":36},{"diffs":[[0,"    "],[-1," "],[1,"}\n"],[0,"       "],[-1,"ss.draw.call(ss, delta);\n"],[0,"     "],[-1,"   "],[1,"\n"],[0,"    "]],"start1":3925,"start2":3925,"length1":49,"length2":23},{"diffs":[[0,"x * "],[-1,"ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss.tileheight, ss.debug_color);\n                    client_data.renderer.draw_debug_text(x * ss.tilewidth, y * ss.tileheight, x+\":\"+y, ss.debug_color);\n            }\n        }\n        \n        /*for(var x = 0; x < layer.width; x++) { \n            for(var y = 0; y < layer.height; y++) {\n                var tid = layer.data[idx];\n                if(tid != 0) {\n                    var ss = this.get_correct_sheet(tid);\n                    ss.current_frame = tid;\n                    ss.x = x * ss.tilewidth;\n                    ss.y = y * ss.tileheight;\n                    ss.update.call(ss, delta);\n                    ss.draw.call(ss, delta);\n                    client_data.renderer.draw_debug_box(x * ss.tilewidth, y * ss.tileheight, ss.tilewidth, ss"],[1,"this.map.tilewidth, y * this.map.tileheight, this.map.tilewidth, this.map"],[0,".til"]],"start1":3992,"start2":3992,"length1":810,"length2":81},{"diffs":[[0,"            "],[-1,"      "],[-1," "],[0,"client_data."]],"start1":4100,"start2":4100,"length1":31,"length2":24},{"diffs":[[0,"ext(x * "],[-1,"ss"],[1,"this.map"],[0,".tilewid"]],"start1":4145,"start2":4145,"length1":18,"length2":24},{"diffs":[[0,"th, y * "],[-1,"ss"],[1,"this.map"],[0,".tilehei"]],"start1":4169,"start2":4169,"length1":18,"length2":24},{"diffs":[[0,"ht, "],[-1,"x+\":\"+y"],[1,"tid"],[0,", ss"]],"start1":4194,"start2":4194,"length1":15,"length2":11},{"diffs":[[0,"    "],[-1,"    "],[-1,"    }\n                idx++;\n            }\n        }  */       "],[1,"}"],[0,"\n   "]],"start1":4224,"start2":4224,"length1":75,"length2":9}]],"length":4239,"saved":false}
{"ts":1350430062821,"patch":[[{"diffs":[[0,"                "],[-1," "],[0,"var ss = this.ge"]],"start1":3578,"start2":3578,"length1":33,"length2":32}]],"length":4238,"saved":false}
{"ts":1350430110043,"patch":[[{"diffs":[[0,"height, "],[-1,"ss.debug_color"],[1,"\"purple\""],[0,");\n     "]],"start1":4073,"start2":4073,"length1":30,"length2":24},{"diffs":[[0,"id, "],[-1,"ss.debug_color"],[1,"\"purple\""],[0,");\n "]],"start1":4192,"start2":4192,"length1":22,"length2":16}]],"length":4226,"saved":false}
{"ts":1350430289928,"patch":[[{"diffs":[[0,"\");\n            "],[-1," "],[0,"client_data.rend"]],"start1":4088,"start2":4088,"length1":33,"length2":32}]],"length":4225,"saved":false}
{"ts":1350430484963,"patch":[[{"diffs":[[0,"delta);\n"],[1,"                    client_data.renderer.draw_debug_text(x * this.map.tilewidth, y * this.map.tileheight, tid, \"purple\");\n"],[0,"        "]],"start1":3908,"start2":3908,"length1":16,"length2":138},{"diffs":[[0,"\");\n"],[-1,"            client_data.renderer.draw_debug_text(x * this.map.tilewidth, y * this.map.tileheight, tid, \"purple\");\n"],[0,"    "]],"start1":4210,"start2":4210,"length1":122,"length2":8}]],"length":4233,"saved":false}
{"ts":1350430565484,"patch":[[{"diffs":[[0,"t, tid, "],[-1,"\"purple\""],[1,"ss.debug_color"],[0,");\n     "]],"start1":4019,"start2":4019,"length1":24,"length2":30}]],"length":4239,"saved":false}
{"ts":1350430931031,"patch":[[{"diffs":[[0,"width | "],[-1,"0"],[1,"1"],[0,"; \n     "]],"start1":3511,"start2":3511,"length1":17,"length2":17}]],"length":4239,"saved":false}
{"ts":1350430964234,"patch":[[{"diffs":[[0,"h | "],[-1,"1"],[1,"0"],[0,"; \n "]],"start1":3515,"start2":3515,"length1":9,"length2":9}]],"length":4239,"saved":false}
{"ts":1350431326220,"patch":[[{"diffs":[[0,"        "],[-1,"ss."],[1,"var _"],[0,"x = x * "]],"start1":3688,"start2":3688,"length1":19,"length2":21},{"diffs":[[0,"        "],[-1,"ss."],[1,"var _"],[0,"y = y * "]],"start1":3741,"start2":3741,"length1":19,"length2":21},{"diffs":[[0," ss.draw"],[1,"_at"],[0,".call(ss"]],"start1":3894,"start2":3894,"length1":16,"length2":19},{"diffs":[[0,"call(ss,"],[1," _x, _y,"],[0," delta);"]],"start1":3906,"start2":3906,"length1":16,"length2":24}]],"length":4254,"saved":false}
{"ts":1350431354137,"patch":[[{"diffs":[[0,"w_at"],[-1,".call(ss, "],[1,"("],[0,"_x, "]],"start1":3901,"start2":3901,"length1":18,"length2":9}]],"length":4245,"saved":false}
{"ts":1350431386222,"patch":[[{"diffs":[[0,"eheight,"],[1,"\n                       "],[0," tid, ss"]],"start1":4019,"start2":4019,"length1":16,"length2":40}]],"length":4269,"saved":false}
{"ts":1350431586013,"patch":[[{"diffs":[[0,"appings[i];\n"],[1,"            this.global_mappings[i].w  = sprite.width;\n            this.global_mappings[i].h  = sprite.hiehgt;\n"],[0,"        }\n  "]],"start1":1461,"start2":1461,"length1":24,"length2":135}]],"length":4380,"saved":false}
{"ts":1350431608085,"patch":[[{"diffs":[[0,"te.h"],[-1,"iehg"],[1,"eigh"],[0,"t;\n "]],"start1":1573,"start2":1573,"length1":12,"length2":12}]],"length":4380,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350591764537,"patch":[[{"diffs":[[0,"rame = tid;\n"],[1,"                    ss.width = ss.tilewidth;\n                    ss.height = ss.tileheight;\n                    \n"],[0,"            "]],"start1":3775,"start2":3775,"length1":24,"length2":137},{"diffs":[[0,"    "],[-1,"ss.width = ss.tilewidth;\n                    ss.height = ss.tileheight;"],[0,"\n   "]],"start1":4023,"start2":4023,"length1":79,"length2":8},{"diffs":[[0,"height, "],[1,"\n                    "],[0,"this.map"]],"start1":4343,"start2":4343,"length1":16,"length2":37}]],"length":4443,"saved":false}
{"ts":1350591773662,"patch":[[{"diffs":[[0,"delta);\n"],[1,"                    \n"],[0,"        "]],"start1":4067,"start2":4067,"length1":16,"length2":37}]],"length":4464,"saved":false}
{"ts":1350591810681,"patch":[[{"diffs":[[0,"index++)"],[-1,"\n       "],[0," {\n     "]],"start1":3487,"start2":3487,"length1":24,"length2":16}]],"length":4456,"saved":false}
{"ts":1350591829445,"patch":[[{"diffs":[[0,"tid "],[-1,"!="],[1,">"],[0," 0)\n"]],"start1":3657,"start2":3657,"length1":10,"length2":9}]],"length":4455,"saved":false}
